from github import Github
import os
from dotenv import load_dotenv

load_dotenv()

def post_fix_to_github(pr_number, file_name, explanation, fix_code):
    # Connect to GitHub
    g = Github(os.getenv("GITHUB_TOKEN"))
    repo = g.get_repo("andrewjos-seb/AutoPatch-Bot")
    pull_request = repo.get_pull(pr_number)

    # Format the message for a professional "Fintech" look
    comment_body = f"""
    ### ðŸ›¡ï¸ Anti-Gravity Security Audit
    **Vulnerability Detected in `{file_name}`**
    
    > **Explanation:** {explanation}
    
    #### ðŸ’¡ Suggested Secure Fix:
    ```python
    {fix_code}
    ```
    *This fix was generated by AI and verified for security linting.*
    """
    
    # Post the comment
    pull_request.create_issue_comment(comment_body)
    print(f"âœ… Fix posted to PR #{pr_number}!")

# Example of how you'd call it after scanning:
# post_fix_to_github(1, "vulnerabilities.py", "SQL Injection found", "cursor.execute('SELECT...', (user_id,))")
